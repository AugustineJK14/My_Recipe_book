const fs = require('fs');
const path = require('path');

// Read .env file
const envPath = path.join(__dirname, '.env');
const envContent = fs.readFileSync(envPath, 'utf8');

// Parse .env content
const envVars = {};
envContent.split('\n').forEach(line => {
    const trimmedLine = line.trim();
    if (trimmedLine && !trimmedLine.startsWith('#')) {
        const [key, ...valueParts] = trimmedLine.split('=');
        if (key && valueParts.length > 0) {
            let value = valueParts.join('=');
            // Remove quotes if present
            value = value.replace(/^['"]|['"]$/g, '');
            envVars[key] = value;
        }
    }
});

// Generate config.js file from .env variables
const configContent = `// ğŸ”§ AUTO-GENERATED FROM .env FILE ğŸ”§
// âš ï¸  DO NOT EDIT THIS FILE DIRECTLY!
// âš ï¸  EDIT .env INSTEAD AND RUN: node build-config.js
// ğŸ“ Source: .env â†’ build-config.js â†’ config.js

export const config = {
    SUPABASE_URL: '${envVars.SUPABASE_URL || ''}',
    SUPABASE_ANON_KEY: '${envVars.SUPABASE_ANON_KEY || ''}'
};

export default config;
`;

// Write config.js
const configPath = path.join(__dirname, 'config.js');
fs.writeFileSync(configPath, configContent);

console.log('âœ… config.js generated successfully from .env file!');
console.log('ğŸ“„ Source: .env â†’ Generated: config.js');
console.log('ğŸ”§ SUPABASE_URL:', envVars.SUPABASE_URL ? 'âœ“ Loaded from .env' : 'âœ— Missing in .env');
console.log('ğŸ”§ SUPABASE_ANON_KEY:', envVars.SUPABASE_ANON_KEY ? 'âœ“ Loaded from .env' : 'âœ— Missing in .env');
